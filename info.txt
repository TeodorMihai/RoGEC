typo generator:
    https://github.com/wsong/Typo-Distance/blob/master/typodistance.py
    -based on Knuth algorithm
    -insertion more likely than deletion

from andrew paper:
    -rare words?
    -word level nn with fixed vocabulary - poorly suited for oov (years)
    -character level works because you only need to copy inpuut -> output (attention si crucial + pyramid structure)
    -combine with a language model (reranker)
    -controlling precision: 
    -multiple way to correct a sentence -> blue not accuracy
    -synthetic errors:  article or determiner errors and noun number errors
    -rich morpholofy -> character levels
    -evaluated on how well its proposed corrections or edits match the gold-standard edits
    -scores for n-grams to detect errors

abbraviations:
    WMT: workshop machien translation
    LM: lamguage model
    NMT: Neural Machine Translation


datasets:
        Corpus          #sent pair    mentions
        WMT News crawl  100M english  also for ro         
        Gutenberg       11.6M         0 ann
        Tatoeba         1.17M         0 ann
        WikiText-103    3.93M         0 ann
        Lang-8          1,114,139     1-8
        CLC             1,366,075     1/private
        NUCLE           57,119        1  
        Extended Lang-8 2,865,639     1 
        FCE             33,200        1
        W&I Train       34,308        1 annotations
        W&I+LOCNESS Dev 4,384         1 annotations
        W&I+L-Test      4,480         5 ANNOT

challanges:
    CoNLL-2014 Shared Task - eval on NUCLE corpus (+10 annotations) + M^2
    JFLEG: 700 sents - GLEU
    BEA: (eval with ERRANT) 
        unrestricted:   proprietary  & all u want
        restricted:     only on FCE, Lang-8, NUCLE, W&I+LOCNESS, NO parallel
        low resource:   only W&I+LOCNESS dev set (no other datatset) but  parallel is fine (wiki)

papers:
    BEA:
        low resource:
            Neural Grammatical Error Correction Systems with UnsupervisedPre-training on Synthetic Data:
                -Microsoft: Roman Grundkiewicz, Marcin Junczys-Dowmunt, Kenneth Heafield†:
                -synthetic data: replace words with confusions sets, constructing confusions set with spellchekers
                        +swapping, deleting words + wikipedia edits 
                -spellchecker based replacing works better than word embeddings or Levensthein dist
                -very detailed work on the model & other stuff (transfformer)
                Interestingly, the performance of restricted and low-resourcse systems on native texts is identical
            The LAIX Systems in the BEA-2019 GEC Shared Task
                -Ruobing Li, Chuan Wang, Yefei Zha, Yonghong Yu, Shiman Guo, Qiang Wang, Yang Liu† Hui Lin†
                -combine classifiers, rules, spell checker and NMT model -> solver 
                -for some error types classfiers trained on NATIVE text have good performance 
                    (labels for each classificator depends on part-of-speech tags)
                    -classifiers (fixed labels nr):
                        -7 error types: subj-ver agr, prep subst, missing comma, verb form 
                        -for word form use the pointer context model (interesting diff labels for each word)
                -for NMT use wiki ed
            Weakly Supervised Grammatical Error Correction using Iterative Decoding
                -Google: Jared Lichtarge, Christopher Alberti, Shankar Kumar, Noam Shazeer, Niki Parmar
                -wikipedia + random char errors only (incremental decoding)
                -after training only on wikipedia, continue to train on Lang 8 corous
            !!A Neural Grammatical Error Correction System Built On Better Pre-training and Sequential Transfer Learning
                Yo Joong Choe, Kakao company, Jiyeon Ham*
                -To tackle this challenge, we first generate erroneous versions of large unannotated corpora using a realistic
                     noising function. The resulting parallel corpora are subsequently used to pre-train Transformer models.
                    Then, by sequentially applying transfer
                    learning, we adapt these models to the domain and style of the test set
    general papers:
        Xie et al. (2016): character lvl encoder + attetion hierarchy (encoder - half each layer) 
                + language model

    
how to annotate:
    1. categories - mandatory - how to define them - diacritics vs spelling
    2. classify proficeny of the writer (maybe grade?) 
    3. tool - see NUCLE corpus
        3. select span (minimum that defines the error) -> correct (can overlap)
            (e annotators were asked to select the minimal text span so that minimal changes were made to
                arrive at the corrected text.)


stats CNA:
    
    added WMT:
        en-ro wmt 700 senences added 
        
    phrases:
        del:
            multor șlagăre	popular/cântecelor populare și al șlagărelor	sintaxă	Sintaxă: Dezacord al articolului genitival.
            o poză șocantă, dezvăluită recent	o poză șocantă, apărută recent	other	semantică
            un avion Airbus cu peste 149 de pasageri la bord	un avion Airbus cu 149 de pasageri la bord	semantică	Semantică: Formulare ilogică avionul avea exact 149 de pasageri.
            dar o întrebare pentru doamna Iolanda?	dar o întrebare pentru doamna Iolanda Balaș?	stilistică	Stilistică: Adresarea sau referirea la o persoană doar prin numele mic, chiar și precedat de doamna, domnul(e), are un grad de politețe redus.

        duplicates:
            economist șef BNR	economist-șef la/al BNR	ortografie
            Uită-te la emisiunea unui nord-vestist /	Uită-te la emisiunea unui prezentator nord-vestic
            discuțiile pe titularizare dezbaterile pe legea învățământului	discuțiile despre titularizare/privind titularizarea dezbaterile privind legea învățământului	sintaxă	Sintaxă: folosirea inadecvată a prepoziției pe.
            proprietar mașină	proprietar al mașinii / proprietarul mașinii	sintaxă	Sintaxă: Nemarcarea relației sintactice.	
        stats:
            inital: 3386
            INFO:root:duplicates wrong: 32
            INFO:root:duplicates pairs (eliminated): 213
            INFO:root:same wrong/correct: 53
            INFO:root:stats per type: {'sintaxă': 1023, 'ortografie': 1149, 'punctuație': 122, 'semantică': 104, 'lexic': 116, 'stilistică': 18, 'other': 107}
            INFO:root:average nr tokens wrong samples 10.052631578947368
            INFO:root:average nr tokens correct samples 9.777777777777779
        errant stats:
            nr_edits_per_sent: 1.416066691928761
            length_edits_per_sentence: 1.6726032588101554
            nr_edits_per_category: {'M:ADP': 319, 'R:NOUN:FORM': 406, 'M:DET': 150, 
                'R:SPELL': 780, 'M:PRON': 166, 'R:ORTH': 130, 'U:OTHER': 67, 'U:ADP': 24, 'M:PUNCT': 154,
                'R:OTHER': 649, 'U:ADJ': 14, 'R:ADJ:FORM': 43, 'M:OTHER': 58, 'R:ADP': 66, 'R:MORPH': 184,
                'R:NOUN': 128, 'U:PRON': 20, 'R:ADJ': 17, 'R:VERB:FORM': 11, 'R:DET': 102, 'U:PUNCT': 38,
                'M:NOUN': 34, 'U:DET': 24, 'U:CCONJ': 30, 'R:DET:FORM': 30, 'U:ADV': 8, 'U:NOUN': 13,
                'R:PUNCT': 23, 'M:CCONJ': 1, 'M:ADV': 2, 'R:CCONJ': 2, 'R:WO': 6, 'R:ADV': 11, 
                'R:PRON:FORM': 11, 'R:PRON': 1, 'M:VERB': 2, 'M:ADJ': 5, 'R:VERB': 7, 'U:VERB': 1}
            length_edits: 1.1811613593791812

    sent:
        del:
            Cine e Badea...s-a inflamat orezul, grișul în el?	[reformulare] Cine se crede Badea?	stilistică	Stilistică: exprimare nereverențioasă în citarea unor posibili comentatori la adresa prezentatorului.
            Când apare un analist la televizor, toată lumea pune botu’	Când apare un analist la televizor, toată lumea îl crede	stilistică	Stilistică
            autocarul a părăsit șoseaua și s-a prăbușit într-o regiune stâncoasă	sugestie: într-o regiune stâncoasă, autocarul a părăsit șoseaua și s-a prăbușit în gol [după cum se vede în imagini]	lexic	lexic (regiune = întindere mare de pământ mai mult sau mai puțin omogenă, dintr-o țară sau de pe glob, care prezintă caractere comune; ținut, zonă.“, DEX)
            mascota emisiunii noastre ... [celălalt prezentator:] să- l ducem la ...	mascota emisiunii noastre ... [celălalt prezentator:] s-o ducem la ...	sintaxă	sintaxă: Dezacord.
            Patru cadavre au fost descoperite la locul cadavrei	Patru cadavre au fost descoperite la locul exploziei	other	Rostire accidentală, necorectată
            Ceea ce însă a lipsit de 1 Mai 2010 în Vama Veche	Ceea ce va lipsi însă de 1 Mai 2010 în Vama Veche	semantică	Semantică: Transmisiunea se face la data de 30 aprilie, care precedă data de 1 Mai. De aceea, folosirea timpului trecut nu este justificată.
            Cumpărătorii au fost încântați mai ales datorită faptului că au economisit până la 200 de lei dacă alegeau să cumpere din librării.	Cumpărătorii au fost încântați mai ales că au economisit până la 200 de lei, fapt care nu s-ar fi întâmplat dacă ar fi ales să cumpere din librării.	sintaxă	Sintaxă, semantică: Construcție defectuoasă a enunțului.
            Hai mă, ... Îi place mă,...	Hai, mă, ... Îi place, mă,...	punctuație	Punctuație: Absența virgulei care separă interjecția de restul enunțului.
            Vă reamintesc, la ora 19 și 30 de minute, declarație președintele Traian Băsescu	Vă reamintesc, la ora 19 și 30 de minute, vom transmite declarația președintelui Traian Băsescu	sintaxă	Sintaxă: Nemarcarea realațiilor sintactice dintre cuvinte.
            Leonard Cohen... va prezenta primul său	Leonard Cohen... va face primul său	semantică	Semantică: verbul a prezenta este nepotrivit contextual (alunecare
            și, mai ales, vor avea parte și de a se bucura de un concert de muzică în cinstea lor, pentru că azi este ziua lor	și, mai ales, vor avea parte de un concert în cinstea lor	semantică	Semantică: Enunț redundant din punct de vedere semantic.
            ...de comportamentul riscant al domnului Strauss-Kahn (par le comportement scabreux de Monsieur Strauss-Kahn)	...de comportamentul imoral/ reprobabil/ indecent al domnului Strauss-Kahn	semantică	Semantică: Traducere inexactă a unei declarații.
            Prognoză România, la noapte Prognoză București	Prognoză pentru România, la noapte Prognoză pentru București	sintaxă	Sintaxă: Nemarcarea relațiilor sintactice.
            N-a excelat în a promite foarte mult	Nu s-a hazardat să promită foarte mult	semantică	Semantică: Folosire improprie a verbului a excela.
            O gara plină de indivizi suspecți; așa-i în gară, întotdeauna. În gară e un loc suspect (?Ramon Cotizo)	O gara plină de indivizi suspecți; așa-i în gară întotdeauna. Gara e un loc suspect
            Care-i maximu’ de ani care ai K l-ai sta în închisoare?	nu știu, de foame, după fete
            Om vedea de unde o să luați banii	Nu se știe de unde o să luați banii
        stats:
            initial: 5500
            INFO:root:duplicates wrong: 62
            INFO:root:duplicates pairs (eliminated): 71
            INFO:root:same wrong/correct: 145
            INFO:root:stats per type: {'sintaxă': 1860, 'ortografie': 1098, 'punctuație': 467, 'semantică': 399, 'lexic': 217, 'stilistică': 53, 'other': 381}  
            INFO:root:average nr tokens wrong samples 19.81578947368421
            INFO:root:average nr tokens correct samples 20.62162162162162
        errant stats:
            nr_edits_per_sent: 1.364022346368715
            length_edits_per_sentence: 1.6989944134078212
            nr_edits_per_category: {'M:PUNCT': 539, 'M:ADP': 414, 'R:NOUN:FORM': 215, 
                    'R:OTHER': 984, 'U:CCONJ': 107, 'R:ORTH': 123, 'M:OTHER': 173, 'R:MORPH': 172, 
                    'U:PUNCT': 154, 'U:ADV': 119, 'U:ADJ': 26, 'R:WO': 90, 'U:OTHER': 282, 'R:VERB': 315,
                    'R:SPELL': 799, 'U:PRON': 47, 'R:ADJ': 24, 'U:ADP': 134, 'R:NOUN': 177, 'R:ADP': 229,
                    'M:VERB': 27, 'R:VERB:FORM': 375, 'R:ADV': 47, 'M:ADV': 37, 'U:VERB': 23, 'R:PUNCT': 54,
                    'M:PRON': 74, 'M:NOUN': 26, 'U:NOUN': 29, 'R:PRON': 7, 'R:DET': 83, 'R:ADJ:FORM': 45, 'R:PRON:FORM': 42,
                    'M:ADJ': 4, 'R:DET:FORM': 23, 'U:DET': 34, 'R:CCONJ': 17, 'M:CCONJ': 3, 'M:DET': 31}
            length_edits: 1.2455766710353866
    
    all:
        errant stats:
            nr_edits_per_sent: 1.383328647736857
            length_edits_per_sentence: 1.689204385718302
            nr_edits_per_category: {'M:ADP': 733, 'R:NOUN:FORM': 621, 'M:DET': 181, 'R:SPELL': 1579, 'M:PRON': 240, 
                'R:ORTH': 253, 'U:OTHER': 349, 'U:ADP': 158, 'M:PUNCT': 693, 'R:OTHER': 1633, 'U:ADJ': 40, 'R:ADJ:FORM': 88, 
                'M:OTHER': 231, 'R:ADP': 295, 'R:MORPH': 356, 'R:NOUN': 305, 'U:PRON': 67, 'R:ADJ': 41, 
                'R:VERB:FORM': 386, 'R:DET': 185, 'U:PUNCT': 192, 'M:NOUN': 60, 'U:DET': 58, 'U:CCONJ': 137, 
                'R:DET:FORM': 53, 'U:ADV': 127, 'U:NOUN': 42, 'R:PUNCT': 77, 'M:CCONJ': 4, 'M:ADV': 39, 'R:CCONJ': 19, 
                'R:WO': 96, 'R:ADV': 58, 'R:PRON:FORM': 53, 'R:PRON': 8, 'M:VERB': 29, 'M:ADJ': 9, 'R:VERB': 322, 'U:VERB': 24}
            length_edits: 1.2211157402702977

wikipedia:
    5k:
        nr_edits_per_sent: 1.9442
        length_edits_per_sentence: 2.3712
        nr_edits_per_category: {'R:SPELL': 3412, 'M:OTHER': 379, 'M:PRON': 501, 'R:OTHER': 1381, 'R:ADJ': 57, 'R:DET': 28, 'U:NOUN': 56, 'M:DET': 40, 'R:ADP': 151, 'M:NOUN': 61, 'U:OTHER': 228, 'R:ORTH': 228, 'U:PUNCT': 154, 'R:NOUN': 455, 'R:CCONJ': 856, 'R:MORPH': 95, 'M:PUNCT': 289, 'U:ADJ': 23, 'U:DET': 33, 'R:VERB:FORM': 59, 'R:PUNCT': 79, 'U:PRON': 251, 'M:ADJ': 43, 'R:WO': 23, 'M:ADP': 41, 'U:ADP': 32, 'R:VERB': 73, 'R:ADV': 15, 'R:NOUN:FORM': 110, 'M:ADV': 51, 'U:CCONJ': 18, 'M:VERB': 17, 'U:VERB': 18, 'M:CCONJ': 22, 'R:PRON': 379, 'R:ADJ:FORM': 28, 'U:ADV': 25, 'R:DET:FORM': 5, 'R:PRON:FORM': 5}
        length_edits: 1.2196276103281556

ERRANT adapted for ro:
    modified for romanian:
        for edits:
            -in process_edits (align_text.py) no possesive merge 
            -spacy for ro with pos and lemmas
            -dict for hunspell from: https://cgit.freedesktop.org/libreoffice/dictionaries/tree/ro/ro_RO.dic
            -ro stemmer from nltk: http://www.nltk.org/_modules/nltk/stem/snowball.html
            -no tag_map (use spacy pos)
            -eliminated any tags (only one plase)
            -eliminated CONTR category (compared to german)
        for categories:
    t2t:
        -by default it uses an invertible wordpiece vocabular,  
            check tensor2tensor/data_generators/text_problems.py  if you want to change it
            https://tensorflow.github.io/tensor2tensor/new_problem.html
            https://github.com/google/sentencepiece

        -learnd embeddings, read here if you want:

    run errant:
        python3 parallel_to_m2.py -lang ro -orig ../corpora/errant_sent_original.txt  -cor ../corpora/errant_sent_corrected.txt -out ../corpora/out.txt
    run t2t:
        cd t2t
        source ./bin/active
        ./transformer_tiny.sh

    aspell:
        sudo apt-get install libaspell-dev
        sudo apt-get install aspell-ro
        pip3 install aspell-python-py3

